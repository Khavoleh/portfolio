---
import ReviewCard from '@shared/review/ReviewCard.astro';
import { REVIEWS } from './constants';
import LinkIcon from './icons/link.svg';
import type { Review } from '@shared/review/interfaces.ts';
import ArrowLeftIcon from './icons/arrow-left.svg';
import ArrowRightIcon from './icons/arrow-right.svg';
import { shuffleArray } from '@components/home/helpers.ts';
import { useTranslations } from '@shared/helpers.ts';
import { REVIEWS_TRANSLATIONS } from './translations.ts';

const t = useTranslations(Astro.url, REVIEWS_TRANSLATIONS);

const translatedReviews: Review[] = REVIEWS.map((review) => ({
  ...review,
  name: t(review.name),
  position: t(review.position),
  text: t(review.text),
}));

const shuffledReviews: Review[] = shuffleArray(translatedReviews);

const buttonsClasses: string =
  'border-default background-default transition-default focus-default pointer-events-auto inline-flex h-10 w-10 cursor-pointer items-center justify-center rounded-lg border opacity-50 shadow-md hover:scale-110 hover:opacity-75 hover:shadow-lg active:scale-95';
---

<section class="mt-12">
  <div class="mb-8 text-center">
    <h2 class="text-primary mb-4 text-3xl font-bold">{t('reviews.title')}</h2>
    <p class="text-secondary mx-auto max-w-2xl text-lg">{t('reviews.subtitle')}</p>
  </div>

  <div id="default-carousel" class="relative w-full" data-carousel="static">
    <div
      class="relative min-h-[550px] overflow-hidden rounded min-[500px]:min-h-[400px] md:min-h-[360px] lg:min-h-[330px]"
    >
      {
        shuffledReviews.map((review: Review) => (
          <div class="hidden duration-1000 ease-in-out" data-carousel-item>
            <div class="absolute inset-0 flex items-center justify-center px-2 py-4 sm:px-4 sm:py-6 md:py-8">
              <div class="flex h-full w-full max-w-4xl items-center">
                <ReviewCard review={review} />
              </div>
            </div>
          </div>
        ))
      }
    </div>

    <div class="absolute left-1/2 z-30 flex -translate-x-1/2 space-x-2 rtl:space-x-reverse">
      {
        shuffledReviews.map((_, index: number) => (
          <button
            type="button"
            class="transition-default border-default focus-default h-4 w-4 rounded-lg border"
            aria-label={`${t('reviews.slide.aria')} ${index + 1}`}
            data-carousel-slide-to={index.toString()}
          />
        ))
      }
    </div>

    <div class="pointer-events-none absolute start-0 top-0 z-30 flex h-full items-center justify-start px-4">
      <button type="button" class={buttonsClasses} data-carousel-prev aria-label={t('reviews.button.previous')}>
        <ArrowLeftIcon class="text-primary" aria-hidden="true" />
      </button>
    </div>

    <div class="pointer-events-none absolute end-0 top-0 z-30 flex h-full items-center justify-end px-4">
      <button type="button" class={buttonsClasses} data-carousel-next aria-label={t('reviews.button.next')}>
        <ArrowRightIcon class="text-primary" aria-hidden="true" />
      </button>
    </div>
  </div>

  <div class="mt-8 text-center">
    <a
      href="https://www.linkedin.com/in/khavol/"
      target="_blank"
      rel="noopener noreferrer"
      class="transition-default focus-default inline-flex items-center gap-2 font-semibold text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300"
    >
      {t('reviews.linkedin.link')}
      <LinkIcon class="h-4 w-4" />
    </a>
  </div>
</section>
