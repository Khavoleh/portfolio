---
import '../styles/global.css';
import { ClientRouter } from 'astro:transitions';
import Navbar from './Navbar.astro';
import Footer from './Footer.astro';
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>Astro Basics</title>
    <ClientRouter />

    <script is:inline>
      (function () {
        const THEME_OPTIONS = {
          LIGHT: 'light',
          DARK: 'dark',
          SYSTEM: 'system',
        };
        const LOCAL_STORAGE_KEY = 'theme';

        const getTheme = () => {
          if (typeof localStorage !== 'undefined') {
            return localStorage.getItem(LOCAL_STORAGE_KEY) || THEME_OPTIONS.SYSTEM;
          }
          return THEME_OPTIONS.SYSTEM;
        };

        const applyTheme = (theme) => {
          if (theme === THEME_OPTIONS.SYSTEM) {
            const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (isDark) {
              document.documentElement.classList.add(THEME_OPTIONS.DARK);
            } else {
              document.documentElement.classList.remove(THEME_OPTIONS.DARK);
            }
          } else if (theme === THEME_OPTIONS.DARK) {
            document.documentElement.classList.add(THEME_OPTIONS.DARK);
          } else {
            document.documentElement.classList.remove(THEME_OPTIONS.DARK);
          }
        };

        const setTheme = (theme) => {
          applyTheme(theme);
          if (typeof localStorage !== 'undefined') {
            localStorage.setItem(LOCAL_STORAGE_KEY, theme);
          }
        };

        window.__themeManager = {
          THEME_OPTIONS,
          LOCAL_STORAGE_KEY,
          getTheme,
          setTheme,
          applyTheme,
        };

        const currentTheme = getTheme();
        applyTheme(currentTheme);

        document.addEventListener('astro:page-load', () => {
          const savedTheme = getTheme();
          applyTheme(savedTheme);
        });
      })();
    </script>
  </head>
  <body class="flex min-h-screen flex-col bg-slate-50 dark:bg-slate-900">
    <Navbar />

    <div class="flex-grow pt-20 pb-2">
      <slot />
    </div>

    <Footer />
  </body>
</html>

<script is:inline src="/scripts/flowbite.min.js"></script>

<script>
  declare global {
    interface Window {
      initFlowbite?: () => void;
    }
  }

  // Flowbite initialization after page navigation
  document.addEventListener('astro:page-load', () => {
    if (typeof window !== 'undefined' && window.initFlowbite) {
      window.initFlowbite();
    }
  });
</script>

<style>
  html,
  body {
    margin: 0;
    width: 100%;
    height: 100%;
  }
</style>
